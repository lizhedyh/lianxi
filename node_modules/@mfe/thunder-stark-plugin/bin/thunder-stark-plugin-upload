#!/usr/bin/env node
const fs = require('fs');
const resolve = require('path').resolve;
const uploadToStark = require('../plugin').uploadToStark;

const args = process.argv;

const isThunderStateFileReg = /thunder-state\.json/;
const dir = process.cwd();

if (!args || !Array.isArray(args)) {
  throw new Error('Insufficient arguments');
}

const lastArg = args[args.length - 1];
const argStr = args.join(' ');

if (!isThunderStateFileReg.test(lastArg)) {
  throw new Error('Lack of thunder-state.json');
}

const thunderStatePath = resolve(dir, lastArg);

if (!fs.existsSync(thunderStatePath)) {
  throw new Error('thunder-state.json is not exists at ' + thunderStatePath);
}

uploadToStark(thunderStatePath)
  .then((uploadResult) => {
    console.log(uploadResult);
  })
  .catch((err) => {
    console.error(err);
    process.exit(-1);
  });