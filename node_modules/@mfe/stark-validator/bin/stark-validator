#!/usr/bin/env node

const path = require('path');
const program = require('commander');
const { 
  parsePatchUrl, 
  validatePatchByUrl, 
  validateFileByUrl,
} = require('../index');


program
  .version(require('../package.json').version)
  .option('--patch-url <patchUrl>', 'Patch url of Stark')
  .option('--file-url <fileUrl>', 'Full file url')
  .option('--file-path <filePath>', 'Full file path in your local file system')
  .parse(process.argv);

console.log('Parsing...');
if (program.patchUrl) {
  console.log('About to validate patch url...');  
  const { projectName, filePair: {
    oldFilePath,
    newFilePath,
  } } = parsePatchUrl(program.patchUrl);
  
  console.log('Project Name: ', projectName);
  console.log('Old File Path: ', oldFilePath);
  console.log('New File Path: ', newFilePath);
  console.log('Validating...');
  
  validatePatchByUrl(program.patchUrl)
    .then((valid) => console.log(`Validate result: ${valid}`))
    .catch(err => console.log(err.toString()));
}

if (program.fileUrl && program.filePath) {
  console.log('About to validate file url...');  
  validateFileByUrl(program.fileUrl, program.filePath)
    .then((valid) => console.log(`Validate result: ${valid}`))
    .catch(err => console.log(err.toString()));
}