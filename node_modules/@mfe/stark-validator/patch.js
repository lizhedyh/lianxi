function recoverMin(source = '', patchContent = '') {
  const units = patchContent.split('\t')
  let content = source
  let pos = 0

  for (let i = 0; i < units.length; i++) {
    const command = units[i][0]
    if (command === '=') {
      pos += parseInt(units[i].slice(1), 10)
    } else if (command === '-') {
      let length = parseInt(units[i].slice(1), 10)
      content = content.slice(0, pos) + content.slice(pos + length)
    } else if (command === '+') {
      let newPartial = decodeURI(units[i].slice(1))
      content = content.slice(0, pos) + newPartial + content.slice(pos)
      pos += newPartial.length
    } else {
      throw new Error('Broken patch found')
    }
  }

  const percent = content.length ? Math.floor(100 * patchContent.length / content.length) : 100

  return {
    content,
    percent,
    fullLength: content.length,
    patchLength: patchContent.length
  }
}

module.exports = {
  recoverMin,
};