const should = require('should/as-function');
const {
  parsePatchUrl,
  validatePatch,
  validatePatchByUrl,
  validateFileByUrl,
} = require('./index');

describe('validateFileByUrl', function() {
  it('should return true if match', async () => {
    const result = await validateFileByUrl('https://s3plus.meituan.net/v1/mss_e2821d7f0cfe4ac1bf9202ecf9590e67/cdn-prod/file:58037fb2/js/app.b54ad5cba28d8a6a25d1.js', './texture/app.b54ad5cba28d8a6a25d1.js');
    should(result).be.exactly(true);
  });

  it('should return false if not match', async () => {
    const result = await validateFileByUrl('https://s3plus.meituan.net/v1/mss_e2821d7f0cfe4ac1bf9202ecf9590e67/cdn-prod/file:58037fb2/js/app.cad5d66c053dabe51113.js', './texture/app.b54ad5cba28d8a6a25d1.js');
    should(result).be.exactly(false);
  });
});

describe('validatePatchByUrl', function() {
  it('should validate 200 correctly', async () => {
    const result = await validatePatchByUrl('https://jarvas-static.meituan.net/diff/ddfb913b?oldFilePath=js%2Fvendor.4fbaf3013cb38a5ab4b9.js&newFilePath=js%2Fvendor.342cf671b122aab8a8a2.js');
    should(result).be.exactly(true);
  });

  it('should validate 404 correctly', async () => {
    const result = await validatePatchByUrl('https://jarvas-static.meituan.net/diff/58037fb2?oldFilePath=js%2Fmanifest.f7d7220e977f16f38b2c.js&newFilePath=js%2Fmanifest.5347f658f9654795478e.js');
    should(result).be.exactly(true);
  });

  it('should validate 303 correctly', async function() {
    this.timeout(10000);
    const result = await validatePatchByUrl('https://jarvas-static.meituan.net/diff/58037fb2?oldFilePath=js%2Fapp.b54ad5cba28d8a6a25d1.js&newFilePath=js%2Fapp.65eac69781e2ff74be8f.js');
    should(result).be.exactly(true);
  });
});