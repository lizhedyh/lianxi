const path = require('path')
const assert = require('assert')

const Injector = require('../plugin/injector/injector')

// options = {
//   path: 'path/to/thunder-state.json',
//   thunderState: Object,
//   chunks: ['manifest', 'vendor', 'entry'],
//   content: 'code',
//   inline: false
// }

module.exports = (options) => {
  let thunderState
  if (options.path) {
    assert(path.isAbsolute(options.path), 'options.path should be an absolute path, try use path.resolve(__dirname, \'path/to/thunder-state.json\')')
    thunderState = require(options.path)
  } else {
    thunderState = options.thunderState
  }

  assert(thunderState, 'must provide thunder-state.json with set options.path or options.thunderState')

  return new Injector(thunderState, options)
}
