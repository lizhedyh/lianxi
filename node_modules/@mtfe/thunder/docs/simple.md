![](http://vfile.meituan.net/scarlett/48ecef7ad639d9a83e4cdcee70ca6eb633889.png)

![''](http://npm.sankuai.com/badge/v/@mtfe/thunder.svg)

> 一个轻量简单易用的 web 资源离线化方案

# 功能

- JavaScript localStorage 缓存离线化
- 基于 service worker 页面、资源离线化
- 资源字符级更新

# 演示

[demo 地址](https://hilongjw.github.io/offlinify/simple/index.html#/b)

# 依赖

- [webpack](https://github.com/webpack/webpack) `2.x` `3.x` `4.x`


# 开始接入

## 第一步：安装 thunder 依赖

```bash

npm install @mtfe/thunder -S

```

## 第二步：配置 thunder webpack 插件

推荐在 `非开发环境` webpack 配置中引入 `Thunder`, 因为 `Thunder` 的缓存特性在开发中并不需要。

```javascript
// webpack.conf.production.js

const ThunderPlugin = require('@mtfe/thunder/plugin')
const HtmlWebpackPlugin = require('html-webpack-plugin')

const webpackConfig = {

  plugins: [
    ...
    new ThunderPlugin({
      project: 'com.meituan.era',
      hookHtmlWebpackPlugin: {
        HtmlWebpackPlugin,
        chunks: ['vendor', 'app']
      }
    }),
    new HtmlWebpackPlugin()
    ...
  ]
  ...
}
```

你需要配置的是 `hookHtmlWebpackPlugin` 中 `chunks` 这里是为了调用 thunder loader 加载第三方资源模块 (vendor)以及入口模块 (app), 请根据项目的相关配置填写这里的配置。

## 第三步：

配置完成，开始开发！

```bash

npm run dev

```

## 更多配置

```javascript
const webpackConfig = {

  plugins: [
    ...
    new ThunderPlugin({
      project: 'com.meituan.era',
      hookHtmlWebpackPlugin: {
        HtmlWebpackPlugin,
        chunks: ['vendor', 'app'],
        // inline 设置为 true 时，thunder 会以 inline script 注入到 HTML 模板中。
        inline: true,
        
        // chunks 是一种快速配置如下格式的 content 方式，不过你可以可以通过自定义 content 来完成自定义需求
        content: `;(function (global) {
          const thunder = window.__thunder__
          thunder.parallel(['manifest', 'vendor', 'app'])
        })(window)`
      }
    })
    ...
  ]
  ...
}
```


## JS 注入位置控制

在 HTMLWebpackPlugin 中默认JS script 注入在 `</body>` 之前的。

在 HTML 模板中添加 `<!--thunder-script-->`，相关资源会替换注入到 `<!--thunder-script-->` 的位置

```html
<body>
  <div id="app"></div>

  <!--thunder-script-->

  <!-- owl SDK：实现模块(http://docs.sankuai.com/doc/f2e_dp/owl/guide/) -->
  <script crossorigin="anonymous" src="//www.dpfile.com/app/owl/static/owl_1.5.21.js"></script>
  <!-- 配置 owl 参数并启动 -->
  <script>
      Owl.start({
          devMode: true,
          project: 'com.sankuai.zc.fe.qradmin',
          pageUrl: window.location.href,
          page: { sample: 1, auto: false },
          metric: { sample: 1, combo: true }
      })
  </script>
</body>
```

## 更多配置：

请参考 [详细配置](https://docs.sankuai.com/doc/zcm/fe-offlinify/)

# Authors && Contributors

[longjiawen@meituan.com]

[duanbingyang@meituan.com]

[liuyanghe02@meituan.com]
