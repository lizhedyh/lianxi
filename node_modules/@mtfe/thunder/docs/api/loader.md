## JS loader

### Thunder.use(plugin)

Arguments: `{ Function } plugin`

Usage: 

```javascript

Thunder.use((thunder) => {
  Thunder.prototype.preUpdate = function (chunkName) {
    ...
  }
})
```

### thunder.bundleLoader(chunkName)

`bundleLoader` 在 thunder 中作为一种常用的模块加载方案，首先会利用本地缓存加载模块。

Arguments: `{ String } chunkName`

Usage: 

```javascript

thunder.bundleLoader('app')
  .then(() => {
      console.log('app.js loaded')
    })

```

### thunder.jsonpLoader(chunkName)

`jsonpLoader` 是 `script` 赋值 `src` 进行模块加载，在 thunder 中作为一种容错方案，不利用本地缓存直接从网络加载模块。

Arguments: `{ String } chunkName`

Usage: 

```javascript

thunder.jsonpLoader('app')
  .then(() => {
      console.log('app.js loaded')
    })

```

### thunder.parallel(chunkNames)

`parallel` 和 `bundleLoader` 机制类似，但支持多个模块的并行加载。

Arguments: `{ Array <String> } chunkNames`

Usage: 

```javascript

thunder.parallel(['vendor', 'app'])
  .then(() => {
      console.log('vendor.js and app.js loaded')
    })

```

### thunder.styleLoader(chunkName)

`styleLoader` 是常规的 thunder 加载 css 的方法，会优先利用浏览器缓存。

Arguments: `<String> chunkName`

Usage: 

```javascript

thunder.styleLoader('app')
  .then(() => {
      console.log('app.[hash].css is loaded')
    })

```

### thunder.prefetch()

`prefetch` 是延迟加载所有当前未缓存的模块

Usage: 

```javascript

thunder.prefetch()
  .then((list) => {
      console.log(`${list.length} 个模块缓存完成`)
    })

```

### thunder.parallelStyle(chunkNames)

`parallelStyle` 是常规的 thunder 加载 css 的方法，会优先利用浏览器缓存。

Arguments: `{ Array <String> } chunkNames`

Usage: 

```javascript

thunder.parallelStyle(['vendor', 'app'])
  .then(() => {
      console.log('vendor.[hash].css and app.[hash].css are loaded')
    })

```


### thunder.serviceWorkerManager

serviceWorkerManager 是 thunder 中对 service worker 注册、通信模块的封装

如果在 thunder 配置了 `service worker` 相关配置，thunder 会初始化 serviceWorkerManager，如果没有相关配置 `thunder.serviceWorkerManager` 为 null

#### serviceWorkerManager

#### serviceWorkerManager.active

- Type: `boolean`

- Default: 

- Usage:

```javascript

if (thunder.serviceWorkerManager && thunder.serviceWorkerManager.active) {
  // service worker 正在运行
} else {
  // service worker 没有运行
}

```

#### serviceWorkerManager.active

- Type: `boolean`

- Default: 

- Usage:

```javascript

if (thunder.serviceWorkerManager && thunder.serviceWorkerManager.active) {
  // service worker 正在运行
} else {
  // service worker 没有运行
}

```

#### serviceWorkerManager.cache.keys()

- Arguments:

- Usage: 

```javascript

thunder.serviceWorkerManager.cache.keys()
  .then(({ data }) => {
      console.log(data)
    })

// log
[
  "https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic",
  "https://fonts.googleapis.com/icon?family=Material+Icons",
  "https://fonts.gstatic.com/s/materialicons/v37/flUhRq6tzZclQEJ-Vdg-IuiaDsNcIhQ8tQ.woff2",
  "https://fonts.gstatic.com/s/roboto/v18/KFOkCnqEu92Fr1Mu51xIIzIXKMny.woff2",
  "https://fonts.gstatic.com/s/roboto/v18/KFOlCnqEu92Fr1MmEU9fBBc4AMP6lQ.woff2",
  "https://fonts.gstatic.com/s/roboto/v18/KFOlCnqEu92Fr1MmWUlfBBc4AMP6lQ.woff2",
  "https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2",
  "https://hilongjw.github.io/offlinify/dist/src-views-PageB-vue.f2d473212007a2b17453.js",
  "https://placeimg.com/64/64/people/8",
  "https://res.wx.qq.com/mmbizwap/zh_CN/htmledition/js/vconsole/3.0.0/vconsole.min.js"
]

```

#### serviceWorkerManager.cache.add(url)

- Arguments: `{ String } url`

- Usage: 

```javascript

thunder.serviceWorkerManager.cache.add('https://github.io')
  .then(() => {
      console.log('added')
    })

```

#### serviceWorkerManager.cache.delete(url)

- Arguments: `{ String } url`

- Usage: 

```javascript

thunder.serviceWorkerManager.cache.delete('https://github.io')
  .then(() => {
      console.log('deleted')
    })

```

#### serviceWorkerManager.cache.clear()

- Arguments: 

- Usage: 

```javascript

thunder.serviceWorkerManager.cache.clear()
  .then(() => {
      console.log('all caches are being cleared')
    })

```


### thunder.logger

logger 是 thunder 中对事件打点的封装模块

#### logger.mark(key, data)

- Arguments: `{ String } key, { Object } data`

- Usage: 

```javascript
thunder.logger.mark('uniq-key', {
  name: 'chunk-a'
})

```

#### logger.markEnd(key, data, noMeta)

- Arguments: `{ String } key, { Object } data, { Boolean } noMeta`

- Usage: 

```javascript

thunder.logger.mark('uniq-key', {
  name: 'chunk-a'
})

loadSomeThing()
  .then(() => {
      thunder.logger.markEnd('uniq-key')
    })


log(thunder.logger.logQueue)

// log
[{
  key: key,
  data: {
    name: 'chunk-a',
    cost: 1000,
    // `noMeta=true` 不会注入以下三个属性
    project: 'your-project',
    network: 'WIFI',
    webview: 'WECHAT'
    
  }
}]
```

#### logger.use(fn, channel)

- Arguments: `{ Function } fn, { String } channel`

- Usage: 

```javascript
thunder.logger.use((data) => {
  console.log(data)
})

// 指定 channel，则只会接收到 `data.channel === channel` 的数据
thunder.logger.use((data) => {
  console.log(data)
}, 'special-channel')

```

### thunder.store

store 是 thunder 中对 localStorage 的封装模块

#### store.get(chunkName)

获取模块代码缓存

- Arguments: `{ String } chunkName`

- Returns: `{ hash, content }`

- Usage: 

```javascript

const payload = thunder.store.get('app')

// payload
{
  hash: '03960c92d2bd06f8f833',
  content: 'var web=webpackJsonpweb(["app"],{"9KF/":function(t,e,a ....'
}
```

#### store.add({ name, hash, content })

添加模块代码缓存

- Arguments: `{ Object { String } name { String } hash, { String } content }`

- Returns: the add status.

- Usage: 

```javascript

const success = thunder.store.add({ name, hash, content })

```

#### store.remove(name)

清理 thunder 中指定名称的模块代码缓存

- Arguments: `{ String } name`

- Usage: 

```javascript

thunder.store.remove('app')

```

#### store.clear()

清理 thunder 在 localStorage 缓存的所有代码模块

- Arguments: `{ String } name`

- Usage: 

```javascript

thunder.store.clear()

```
