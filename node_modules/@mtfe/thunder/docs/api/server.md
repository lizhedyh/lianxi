## server helper

### genThunderInjector

- Arguments: `{ Object } options`

- returns: `Injector`

- Usage: 

```javascript

const thunderState = require('path/to/thunder-state.json')
const genThunderInjector = require('@mtfe/thunder/server/injector')

const thunderInjector = genThunderInjector({
    path: 'path/to/thunder-state.json',
    // 选择传入 path 或者 直接传入 thunderState
    // thunderState: thunderState,

    // 加载 CSS 模块
    styles: ['manifest', 'vendor', 'entry'],

    // 加载 JS 模块
    chunks: ['manifest', 'vendor', 'entry'],

    // 启用预加载
    prefetch: true
})

```

### thunderInjector

thunderInjector 是注入静态资源的工具

- Arguments: `{ Object } thunderState, { Object } options`

- returns: `Injector`

- Usage: 

```javascript

const thunderState = require('path/to/thunder-state.json')
const genThunderInjector = require('@mtfe/thunder/server/injector')

const thunderInjector = genThunderInjector({
    path: 'path/to/thunder-state.json',
    // 选择传入 path 或者 直接传入 thunderState
    thunderState: thunderState,
    chunks: ['manifest', 'vendor', 'entry']
})

```

### thunderInjector.getStyleNodes()

`getStyleNodes` 输出所有和配置中定义的 `chunks` 相关的 css 资源节点集合

- Arguments:

- returns: `{ Array } nodes`

- Usage: 

```javascript

const nodes = thunderInjector.getStyleNodes()
console.log(nodes)

// log
[{
  tag: "link",
  selfClose: true,
  attrs: {
    rel: "stylesheet",
    href: "/static/dist/css/app.d548948a.css"
  }
}]

```

### thunderInjector.getScriptNodes()

`getScriptNodes` 输出所有和配置中定义的 `chunks` 相关的 js 资源节点集合

- Arguments:

- returns: `{ Array } nodes`

- Usage: 

```javascript

const nodes = thunderInjector.getScriptNodes()

console.log(nodes)

// log
[{
  tag: "script",
  attrs: {
    type: "application/javascript",
    src: "/static/dist/js/thunder.398753f41c25.js"
  }
}, {
  tag: "script",
  attrs: {
    type: "application/javascript"
  },
  children: [";(function (global) {\n  var thunder = window.__thunder__\n  thunder.parallel([\n  \"manifest\",\n  \"vendor\",\n  \"app\"]) \n })(window)"]
}]

```

### thunderInjector.getStylesContent()

`getStylesContent` 是基于 `getStyleNodes` 输出的 nodes 的节点定义输出 HTML 标签字符，用于在模板中直接填充。

- Arguments:

- returns: `{ String } content`

- Usage: 

```javascript

const cssTagString = thunderInjector.getStylesContent()

console.log(cssTagString)

// log
"<link rel="stylesheet" href="/offlinify/simple/app.d548948a.css">"

```

### thunderInjector.getScriptsContent()

`getScriptsContent` 是基于 `getScriptNodes` 输出的 nodes 的节点定义输出 HTML 标签字符，用于在模板中直接填充。

- Arguments:

- returns: `{ String } content`

- Usage: 

```javascript

const scriptTagString = thunderInjector.getScriptsContent()

console.log(scriptTagString)

// log
<script type="application/javascript">...</script>
<script type="application/javascript">
;(function (global) {
  var thunder = window.__thunder__
  thunder.parallel([
  "manifest",
  "vendor",
  "app"
])
})(window)
</script>

```

### thunderInjector.getServiceWorkerContent()

`getServiceWorkerContent` 用于输出 service worker

- Arguments:

- returns: `{ String } content`

- Usage: 

```javascript

router.get('/service-worker.js'), ctx => {
  ctx.set({
    'Content-Type': 'application/javascript; charset=UTF-8',
    'Service-Worker-Allowed': '/',
  })
  ctx.body = injector.getServiceWorkerContent()
})

```
