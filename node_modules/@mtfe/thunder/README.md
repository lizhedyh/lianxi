# Thunderjs

![](http://vfile.meituan.net/scarlett/48ecef7ad639d9a83e4cdcee70ca6eb633889.png)

![''](http://npm.sankuai.com/badge/v/@mtfe/thunder.svg)
[![Build Status](http://castle.sankuai.com/api/badge/zcm/fe-offlinify)](http://castle.sankuai.com/gh/zcm/fe-offlinify)

> ä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ¸è¿›å¼ web èµ„æºç¼“å­˜ä¸ç¦»çº¿åŒ–æ–¹æ¡ˆ

## ç®€ä»‹

`Thunder` æ˜¯ä¸€ä¸ªæ¸è¿›å¼èµ„æºç¼“å­˜ä¸ç¦»çº¿åŒ–æ–¹æ¡ˆã€‚å®ƒé€šè¿‡æµè§ˆå™¨æœ¬åœ°å­˜å‚¨(localStorage/IndexedDB)ç¼“å­˜èµ„æºï¼Œå¹¶ä¸”åŸºäº service-worker æä¾›äº†ç¦»çº¿åŒ–èƒ½åŠ›ã€‚`Thunder` çš„æ¥å…¥æ–¹å¼ç®€å•ï¼Œä¸ä¼šä¾µå…¥ä½ çš„ä¸šåŠ¡ä»£ç ï¼Œä»…éœ€ç®€å•çš„é…ç½®ï¼Œå³å¯è®©ä½ çš„ `Webpack` é¡¹ç›®äº«å—é«˜é€Ÿèµ„æºåŠ è½½ã€‚æ¬¢è¿è¯•ç”¨ï¼

### åŠŸèƒ½

- æ¸è¿›å¼ web èµ„æºç¦»çº¿åŒ–: localStorage/IndexedDB æä¾› JS ã€CSS ç¦»çº¿åŒ–ï¼ŒServiceWorker å…¨ç«™ç¦»çº¿åŒ–
- å¢é‡æ›´æ–°ï¼šè¿›ä¸€æ­¥åˆ©ç”¨ç¼“å­˜ï¼Œé™ä½èµ„æºç‰ˆæœ¬æ›´æ–°æˆæœ¬
- èµ„æºå¼‚å¸¸è‡ªåŠ¨ CDN é™çº§: æä¾›é¡µé¢èµ„æºåŠ è½½ç¨³å®šæ€§ 
- CDN åŠ«æŒè‡ªåŠ¨é™çº§: JS å†…å®¹æ£€æŸ¥æ ¡éªŒå’Œï¼Œä¸ç¬¦åˆè‡ªåŠ¨åˆ‡æ¢é™çº§ CDN
- æé€Ÿé¡µé¢åŠ è½½æ€§èƒ½: SDK gzip å 8 KB, ç»“åˆç¦»çº¿åŒ–å’Œå¢åŠ æ›´æ–°ï¼Œæå‡ç°ä»£ web åº”ç”¨åŠ è½½ä½“éªŒ
- æ¥å…¥ç®€å•å¿«æ·ï¼šä½¿ç”¨ webpack æ’ä»¶å³å¯æ¥å…¥ï¼Œä¸ä¾µå…¥ä¸šåŠ¡


### ç¯å¢ƒè¦æ±‚

- [node](https://nodejs.org/en/): 6.xåŠä»¥ä¸Š
- [webpack](https://github.com/webpack/webpack): `2.x` `3.x` `4.x`
- chrome 18+ 

## ç«‹å³æ¥å…¥

è¯·å‚è€ƒï¼š[è¯¦ç»†æ–‡æ¡£](https://docs.sankuai.com/doc/zcm/fe-offlinify/)

## å®éªŒé¡µé¢

æˆ‘ä»¬éƒ¨ç½²äº† 4 ä¸ªå®éªŒæµ‹è¯•é¡µé¢ï¼Œç‚¹å‡»ğŸ‘‡åœ°å€å¯ä»¥ä½“éªŒæœ€æ–°ç‰ˆæœ¬çš„ thunder

[æ™®é€šæ¨¡å¼](https://jarvas.meituan.com/dynamic/a234666d/common.html#/carbon?thunderType=cache): ä¸ä½¿ç”¨ thunder é¡µé¢

[LS cache](https://jarvas.meituan.com/dynamic/a234666d/index.html#/carbon?thunderType=cache): ä½¿ç”¨ localStorage ç¼“å­˜çš„é¡µé¢

[IDB cache](https://jarvas.meituan.com/dynamic/a234666d/idb.html#/carbon?thunderType=cache): ä½¿ç”¨ IndexedDB ç¼“å­˜çš„é¡µé¢

[SW cache](https://jarvas.meituan.com/dynamic/a234666d/sw/index.html#/carbon?thunderType=cache): å¯ç”¨ service worker çš„é¡µé¢

## å®‰è£…

### npm

```bash

$ npm install @mtfe/thunder

```

## å¼€å‘

### å¼€å‘æ¨¡å¼

#### SDK å¼€å‘

express + åŠ¨æ€ rollup æ³¨å…¥ sdk ä»£ç ï¼Œå®æ—¶ä¿®æ”¹ lib ä¸‹ sdk ä»£ç ï¼Œå¯ä»¥åˆ·æ–°å¼€å‘è°ƒè¯•

```javascript
npm run start:app
```

æµè§ˆå™¨æ‰“å¼€ `http://127.0.0.1:3000/pay/?type=tiny`


#### plugin å¼€å‘

å¯åŠ¨ webpack dev server

```javascript
npm run start:dev
```

æµè§ˆå™¨æ‰“å¼€ `http://127.0.0.1:8080/pay/?type=tiny`


### ä»£ç æµ‹è¯•

thunder çš„æµ‹è¯•ä»£ç å…¨éƒ¨åœ¨ test ç›®å½•ä¸­

å…¶ä¸­ server å’Œ webpack plugin ä»£ç ç›´æ¥ä½¿ç”¨ mocha æµ‹è¯•

client ä»£ç ä½¿ç”¨ karma æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test 

# æµ‹è¯• client ä»£ç 
npm run test:client

# æµ‹è¯• plugin ä»£ç 
npm run test:plugin

// æµ‹è¯• webpack3 / webpack4 ä¸‹çš„ thunder plugin
// webpack4 éœ€è¦å®‰è£…ä¾èµ–
npm run test:plugin:w4
npm run test:plugin:w3

# æµ‹è¯• server helper ä»£ç 
npm run test:server

```


### ä»£ç  Lint

ä½¿ç”¨ eslint å’Œ [StandardJS](https://github.com/standard/standard)

æµ‹è¯• plugin å¯èƒ½éœ€è¦ webpack4ï¼Œè¯·å…ˆè¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…

```bash
sh test/prepare.sh
```

```bash

# lint æ‰€æœ‰ä»£ç 
npm run lint

# lint client ä»£ç 
npm run lint:client

# lint service worker ä»£ç 
npm run lint:sw

# lint server helper ä»£ç 
npm run lint:server

# lint webpack plugin ä»£ç 
npm run lint:sw

```

## æ›´æ–°å†å²

[æ›´æ–°å†å²](https://docs.sankuai.com/doc/zcm/fe-offlinify/history)

