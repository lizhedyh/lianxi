# Thunderjs

![](http://vfile.meituan.net/scarlett/48ecef7ad639d9a83e4cdcee70ca6eb633889.png)

![''](http://npm.sankuai.com/badge/v/@mtfe/thunder.svg)
[![Build Status](http://castle.sankuai.com/api/badge/zcm/fe-offlinify)](http://castle.sankuai.com/gh/zcm/fe-offlinify)

> 一个简单易用的渐进式 web 资源缓存与离线化方案

## 简介

`Thunder` 是一个渐进式资源缓存与离线化方案。它通过浏览器本地存储(localStorage/IndexedDB)缓存资源，并且基于 service-worker 提供了离线化能力。`Thunder` 的接入方式简单，不会侵入你的业务代码，仅需简单的配置，即可让你的 `Webpack` 项目享受高速资源加载。欢迎试用！

### 功能

- 渐进式 web 资源离线化: localStorage/IndexedDB 提供 JS 、CSS 离线化，ServiceWorker 全站离线化
- 增量更新：进一步利用缓存，降低资源版本更新成本
- 资源异常自动 CDN 降级: 提供页面资源加载稳定性 
- CDN 劫持自动降级: JS 内容检查校验和，不符合自动切换降级 CDN
- 极速页面加载性能: SDK gzip 后 8 KB, 结合离线化和增加更新，提升现代 web 应用加载体验
- 接入简单快捷：使用 webpack 插件即可接入，不侵入业务


### 环境要求

- [node](https://nodejs.org/en/): 6.x及以上
- [webpack](https://github.com/webpack/webpack): `2.x` `3.x` `4.x`
- chrome 18+ 

## 立即接入

请参考：[详细文档](https://docs.sankuai.com/doc/zcm/fe-offlinify/)

## 实验页面

我们部署了 4 个实验测试页面，点击👇地址可以体验最新版本的 thunder

[普通模式](https://jarvas.meituan.com/dynamic/a234666d/common.html#/carbon?thunderType=cache): 不使用 thunder 页面

[LS cache](https://jarvas.meituan.com/dynamic/a234666d/index.html#/carbon?thunderType=cache): 使用 localStorage 缓存的页面

[IDB cache](https://jarvas.meituan.com/dynamic/a234666d/idb.html#/carbon?thunderType=cache): 使用 IndexedDB 缓存的页面

[SW cache](https://jarvas.meituan.com/dynamic/a234666d/sw/index.html#/carbon?thunderType=cache): 启用 service worker 的页面

## 安装

### npm

```bash

$ npm install @mtfe/thunder

```

## 开发

### 开发模式

#### SDK 开发

express + 动态 rollup 注入 sdk 代码，实时修改 lib 下 sdk 代码，可以刷新开发调试

```javascript
npm run start:app
```

浏览器打开 `http://127.0.0.1:3000/pay/?type=tiny`


#### plugin 开发

启动 webpack dev server

```javascript
npm run start:dev
```

浏览器打开 `http://127.0.0.1:8080/pay/?type=tiny`


### 代码测试

thunder 的测试代码全部在 test 目录中

其中 server 和 webpack plugin 代码直接使用 mocha 测试

client 代码使用 karma 测试

```bash
# 运行所有测试
npm run test 

# 测试 client 代码
npm run test:client

# 测试 plugin 代码
npm run test:plugin

// 测试 webpack3 / webpack4 下的 thunder plugin
// webpack4 需要安装依赖
npm run test:plugin:w4
npm run test:plugin:w3

# 测试 server helper 代码
npm run test:server

```


### 代码 Lint

使用 eslint 和 [StandardJS](https://github.com/standard/standard)

测试 plugin 可能需要 webpack4，请先运行以下命令安装

```bash
sh test/prepare.sh
```

```bash

# lint 所有代码
npm run lint

# lint client 代码
npm run lint:client

# lint service worker 代码
npm run lint:sw

# lint server helper 代码
npm run lint:server

# lint webpack plugin 代码
npm run lint:sw

```

## 更新历史

[更新历史](https://docs.sankuai.com/doc/zcm/fe-offlinify/history)

