import 'regenerator-runtime/runtime'
import serviceWorkerRuntime from './runtime'

self.serviceWorkerRuntime = serviceWorkerRuntime

self.addEventListener('install', event => {
  if (serviceWorkerRuntime._initJob) {
    event.waitUntil(
      serviceWorkerRuntime._initJob
        .then(() => self.skipWaiting())
    )
  } else {
    event.waitUntil(self.skipWaiting())
  }
})

self.addEventListener('activate', event => {
  event.waitUntil(
    self.clients.claim()
  )
})

self.addEventListener('message', serviceWorkerRuntime.messageHandler)

self.addEventListener('fetch', serviceWorkerRuntime.fetchHandler)
